<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule Agent Call - Natoli Tax Services</title>
    <link rel="icon" type="image/x-icon" href="_MConverter.eu_text.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        /* ── Reset & Variables ───────────────────────────── */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --forest-green: #3d5a29;
            --forest-green-dark: #2d4419;
            --dark-green-bg: #1e3a0f;
            --cream: #fafaf8;
            --cream-light: #ffffff;
            --cream-dark: #f5f3ed;
            --cream-border: #e8e6e0;
            --text-primary: #1a1a1a;
            --text-secondary: #5c5c5c;
            --text-tertiary: #8a8a8a;
            --border: #e0ded8;
            --fs-xs: 0.875rem;
            --fs-sm: 0.95rem;
            --fs-base: 1.05rem;
            --fs-md: 1.15rem;
            --fs-lg: 1.35rem;
            --fs-xl: 2.1rem;
            --space-xs: 0.75rem;
            --space-sm: 1.25rem;
            --space-md: 2rem;
            --space-lg: 3rem;
            --space-xl: 4.5rem;
        }
        body {
            font-family: 'Inter', system-ui, sans-serif;
            font-size: var(--fs-base);
            color: var(--text-primary);
            background: var(--cream);
            line-height: 1.68;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        main { flex: 1 0 auto; }
        h1, h2, h3 {
            font-weight: 500;
            letter-spacing: -0.025em;
            line-height: 1.2;
        }
        .content-wrapper {
            width: 100%;
            max-width: 76rem;
            margin: 0 auto;
            padding: 0 1.5rem;
        }
        /* ── Page Hero ───────────────────────────────────── */
        .page-hero {
            background: var(--cream-light);
            padding: clamp(3.8rem, 10vh, 5.5rem) 0 clamp(2.8rem, 7vh, 4rem);
            text-align: center;
            border-bottom: 1px solid var(--cream-border);
        }
        .page-hero h1 {
            font-size: clamp(2rem, 5vw, 2.8rem);
            margin-bottom: var(--space-xs);
            color: var(--text-primary);
        }
        /* ── Form Body ───────────────────────────────────── */
        .form-body {
            padding: clamp(2.4rem, 6vh, 3.8rem) 0 clamp(3rem, 8vh, 5rem);
        }
        .form-inner {
            max-width: 740px;
            margin: 0 auto;
        }
        /* ── Info Banner ─────────────────────────────────── */
        .info-banner {
            background: var(--cream-light);
            border: 1px solid var(--cream-border);
            border-left: 3px solid var(--forest-green);
            border-radius: 10px;
            padding: 1rem 1.2rem;
            margin-bottom: var(--space-md);
            font-size: var(--fs-sm);
            color: var(--text-secondary);
            line-height: 1.6;
        }
        .info-banner strong { color: var(--text-primary); font-weight: 500; }
        /* ── Form Card ───────────────────────────────────── */
        .form-section {
            background: var(--cream-light);
            border: 1px solid var(--cream-border);
            border-radius: 14px;
            padding: clamp(1.8rem, 4vw, 2.4rem);
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }
        .section-header {
            display: flex;
            align-items: center;
            gap: 0.7rem;
            margin-bottom: var(--space-sm);
            padding-bottom: var(--space-sm);
            border-bottom: 1px solid var(--cream-border);
        }
        .section-icon {
            width: 34px; height: 34px;
            border-radius: 8px;
            background: #eef4ea;
            display: flex; align-items: center; justify-content: center;
            color: var(--forest-green);
            font-size: 0.95rem; flex-shrink: 0;
        }
        .section-header h3 {
            font-size: var(--fs-md);
            color: var(--text-primary);
            font-weight: 500;
        }
        /* ── Form Fields ─────────────────────────────────── */
        .form-group { margin-bottom: var(--space-sm); }
        .field-label {
            display: flex; align-items: baseline; gap: 0.35rem;
            margin-bottom: 0.4rem;
        }
        .field-label span {
            font-size: var(--fs-sm);
            font-weight: 500;
            color: var(--text-primary);
        }
        .field-label .req { color: #c0392b; }
        .field-input {
            width: 100%;
            padding: 0.68rem 0.88rem;
            font-size: var(--fs-sm);
            font-family: 'Inter', system-ui, sans-serif;
            border: 1px solid var(--cream-border);
            border-radius: 8px;
            background: var(--cream);
            color: var(--text-primary);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .field-input:focus {
            outline: none;
            border-color: var(--forest-green);
            box-shadow: 0 0 0 3px rgba(61,90,41,0.12);
            background: var(--cream-light);
        }
        .field-input::placeholder { color: var(--text-tertiary); }
        /* ── Schedule Grid ───────────────────────────────── */
        .grid-label {
            font-size: var(--fs-sm);
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.3rem;
        }
        .grid-sub {
            font-size: var(--fs-xs);
            color: var(--text-tertiary);
            margin-bottom: 0.75rem;
        }
        .schedule-table-wrap {
            overflow-x: hidden;
            border-radius: 12px;
            border: 1px solid var(--cream-border);
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: unset;
            table-layout: fixed;
        }
        /* ── Thead ───────────────────────────────────────── */
        thead th {
            background: var(--forest-green);
            color: white;
            padding: 0.95rem 0.6rem;
            font-size: 1rem;
            font-weight: 600;
            text-align: center;
            border-right: 1px solid rgba(255,255,255,0.18);
            letter-spacing: 0.01em;
        }
        thead th:first-child {
            width: 22%;
        }
        thead th:last-child {
            border-right: none;
            width: 14%;
        }
        /* ── Tbody rows ──────────────────────────────────── */
        tbody tr {
            border-top: 1px solid var(--cream-border);
            transition: background 0.12s ease;
        }
        tbody tr:hover:not(.row-global) { background: #f7faf4; }
        tbody td {
            padding: 0.85rem 0.6rem;
            text-align: center;
            vertical-align: middle;
            border-right: 1px solid var(--cream-border);
            word-wrap: break-word;
        }
        tbody td:last-child { border-right: none; }
        tbody td:first-child {
            text-align: left;
            padding-left: 1rem;
            font-weight: 500;
        }
        .day-name {
            font-size: 0.98rem;
            font-weight: 500;
            color: var(--text-primary);
        }
        .day-check, .slot-check, .col-check, .global-check {
            width: 20px; height: 20px;
            accent-color: var(--forest-green);
            cursor: pointer;
            transition: transform 0.12s ease;
        }
        .day-check:hover, .slot-check:hover, .col-check:hover, .global-check:hover {
            transform: scale(1.18);
        }
        /* ── Global "All" row ────────────────────────────── */
        .row-global {
            background: #e8f4e0 !important;
            border-top: 2px solid var(--forest-green) !important;
        }
        .row-global td {
            background: #e8f4e0;
            font-weight: 600;
        }
        .row-global td:first-child {
            color: var(--forest-green);
            font-size: 0.98rem;
            letter-spacing: 0.02em;
        }
        /* ── Submit ──────────────────────────────────────── */
        .btn-submit {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            padding: 0.88rem;
            font-size: var(--fs-base);
            font-weight: 500;
            font-family: 'Inter', system-ui, sans-serif;
            background: var(--forest-green);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.22s ease;
            margin-top: var(--space-sm);
        }
        .btn-submit:hover:not(:disabled) {
            background: var(--forest-green-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(61,90,41,0.28);
        }
        .btn-submit:disabled {
            background: var(--cream-border);
            color: var(--text-tertiary);
            cursor: not-allowed;
            transform: none; box-shadow: none;
        }
        /* ── Responsive ──────────────────────────────────── */
        @media (max-width: 768px) {
            .content-wrapper { padding: 0 1.25rem; }
            .page-hero { padding: clamp(2.8rem, 8vh, 4rem) 0 clamp(2rem, 5vh, 2.8rem); }
            .form-section { padding: 1.4rem 1.2rem; }
            thead th { padding: 0.8rem 0.6rem; font-size: 0.92rem; }
            tbody td { padding: 0.7rem 0.6rem; }
            .day-name { font-size: 0.92rem; }
        }
        /* ── Mobile-only compactness ─────────────────────── */
        @media (max-width: 640px) {
            thead th, tbody td {
                padding: 0.6rem 0.4rem;
                font-size: 0.82rem;
            }
            thead th:first-child, tbody td:first-child {
                padding-left: 0.7rem;
            }
            .day-name {
                font-size: 0.88rem;
            }
            .day-check, .slot-check, .col-check, .global-check {
                width: 17px;
                height: 17px;
            }
            .row-global td {
                padding: 0.6rem 0.4rem;
            }
            .form-section {
                padding: 1.3rem 1rem;
            }
        }
        @media (max-width: 480px) {
            thead th, tbody td {
                padding: 0.5rem 0.35rem;
                font-size: 0.78rem;
            }
            .day-name {
                font-size: 0.82rem;
            }
        }
    </style>
</head>
<body>
<div id="header-container"></div>

<main>
    <section class="page-hero">
        <div class="content-wrapper">
            <h1>Schedule a Call</h1>
        </div>
    </section>

    <section class="form-body">
        <div class="content-wrapper">
            <div class="form-inner">
                <div class="info-banner">
                    Let us know when you're available and one of our tax agents will reach out to you.
                </div>

                <div class="form-section">
                    <div class="section-header">
                        <div class="section-icon"><i class="fas fa-phone-flip"></i></div>
                        <h3>Your Availability</h3>
                    </div>

                    <form id="scheduleForm">
                        <!-- Phone -->
                        <div class="form-group">
                            <div class="field-label">
                                <span>Phone Number <span class="req">*</span></span>
                            </div>
                            <input class="field-input" type="tel" id="phone" placeholder="(XXX) XXX-XXXX" required>
                        </div>

                        <!-- Grid -->
                        <div class="form-group">
                            <div class="grid-label">Select Your Available Times <span class="req" style="color:#c0392b;">*</span></div>
                            <div class="grid-sub">Check the boxes for times that work for you. (minimum 4 required)</div>

                            <div class="schedule-table-wrap">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Day</th>
                                            <th>Morning</th>
                                            <th>Afternoon</th>
                                            <th>Evening</th>
                                            <th>All</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><span class="day-name" data-full="Monday">Monday</span></td>
                                            <td><input type="checkbox" class="slot-check time-slot" name="schedule" value="Monday/Morning"   data-day="Monday" data-time="morning"></td>
                                            <td><input type="checkbox" class="slot-check time-slot" name="schedule" value="Monday/Afternoon" data-day="Monday" data-time="afternoon"></td>
                                            <td><input type="checkbox" class="slot-check time-slot" name="schedule" value="Monday/Evening"  data-day="Monday" data-time="evening"></td>
                                            <td><input type="checkbox" class="day-check select-day" data-day="Monday"></td>
                                        </tr>
                                        <tr>
                                            <td><span class="day-name" data-full="Tuesday">Tuesday</span></td>
                                            <td><input type="checkbox" class="slot-check time-slot" name="schedule" value="Tuesday/Morning"   data-day="Tuesday" data-time="morning"></td>
                                            <td><input type="checkbox" class="slot-check time-slot" name="schedule" value="Tuesday/Afternoon" data-day="Tuesday" data-time="afternoon"></td>
                                            <td><input type="checkbox" class="slot-check time-slot" name="schedule" value="Tuesday/Evening"  data-day="Tuesday" data-time="evening"></td>
                                            <td><input type="checkbox" class="day-check select-day" data-day="Tuesday"></td>
                                        </tr>
                                        <tr>
                                            <td><span class="day-name" data-full="Wednesday">Wednesday</span></td>
                                            <td><input type="checkbox" class="slot-check time-slot" name="schedule" value="Wednesday/Morning"   data-day="Wednesday" data-time="morning"></td>
                                            <td><input type="checkbox" class="slot-check time-slot" name="schedule" value="Wednesday/Afternoon" data-day="Wednesday" data-time="afternoon"></td>
                                            <td><input type="checkbox" class="slot-check time-slot" name="schedule" value="Wednesday/Evening"  data-day="Wednesday" data-time="evening"></td>
                                            <td><input type="checkbox" class="day-check select-day" data-day="Wednesday"></td>
                                        </tr>
                                        <tr>
                                            <td><span class="day-name" data-full="Thursday">Thursday</span></td>
                                            <td><input type="checkbox" class="slot-check time-slot" name="schedule" value="Thursday/Morning"   data-day="Thursday" data-time="morning"></td>
                                            <td><input type="checkbox" class="slot-check time-slot" name="schedule" value="Thursday/Afternoon" data-day="Thursday" data-time="afternoon"></td>
                                            <td><input type="checkbox" class="slot-check time-slot" name="schedule" value="Thursday/Evening"  data-day="Thursday" data-time="evening"></td>
                                            <td><input type="checkbox" class="day-check select-day" data-day="Thursday"></td>
                                        </tr>
                                        <tr>
                                            <td><span class="day-name" data-full="Friday">Friday</span></td>
                                            <td><input type="checkbox" class="slot-check time-slot" name="schedule" value="Friday/Morning"   data-day="Friday" data-time="morning"></td>
                                            <td><input type="checkbox" class="slot-check time-slot" name="schedule" value="Friday/Afternoon" data-day="Friday" data-time="afternoon"></td>
                                            <td><input type="checkbox" class="slot-check time-slot" name="schedule" value="Friday/Evening"  data-day="Friday" data-time="evening"></td>
                                            <td><input type="checkbox" class="day-check select-day" data-day="Friday"></td>
                                        </tr>
                                        <tr>
                                            <td><span class="day-name" data-full="Saturday">Saturday</span></td>
                                            <td><input type="checkbox" class="slot-check time-slot" name="schedule" value="Saturday/Morning"   data-day="Saturday" data-time="morning"></td>
                                            <td><input type="checkbox" class="slot-check time-slot" name="schedule" value="Saturday/Afternoon" data-day="Saturday" data-time="afternoon"></td>
                                            <td><input type="checkbox" class="slot-check time-slot" name="schedule" value="Saturday/Evening"  data-day="Saturday" data-time="evening"></td>
                                            <td><input type="checkbox" class="day-check select-day" data-day="Saturday"></td>
                                        </tr>
                                        <tr class="row-global">
                                            <td><span class="day-name">All</span></td>
                                            <td><input type="checkbox" class="col-check" id="selectAllMorning"></td>
                                            <td><input type="checkbox" class="col-check" id="selectAllAfternoon"></td>
                                            <td><input type="checkbox" class="col-check" id="selectAllEvening"></td>
                                            <td><input type="checkbox" class="global-check" id="selectAllTimes"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <button type="submit" class="btn-submit" id="submitBtn">
                            <i class="fas fa-paper-plane"></i> Submit Availability
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </section>
</main>

<div id="footer-container"></div>

<script>
// ── Schedule Grid Logic ─────────────────────────────────
(function() {
    const clientData = JSON.parse(sessionStorage.getItem('clientData') || '{}');
    const colCheckboxes = {
        morning: document.getElementById('selectAllMorning'),
        afternoon: document.getElementById('selectAllAfternoon'),
        evening: document.getElementById('selectAllEvening')
    };
    const selectAllTimes = document.getElementById('selectAllTimes');

    document.querySelectorAll('.select-day').forEach(cb => {
        cb.addEventListener('change', function() {
            const day = this.dataset.day;
            document.querySelectorAll(`.time-slot[data-day="${day}"]`).forEach(s => s.checked = this.checked);
            syncColumnCheckboxes();
            syncGlobalCheckbox();
        });
    });

    Object.entries(colCheckboxes).forEach(([time, cb]) => {
        if (!cb) return;
        cb.addEventListener('change', function() {
            document.querySelectorAll(`.time-slot[data-time="${time}"]`).forEach(s => s.checked = this.checked);
            syncRowCheckboxes();
            syncGlobalCheckbox();
        });
    });

    selectAllTimes.addEventListener('change', function() {
        const checked = this.checked;
        document.querySelectorAll('.time-slot').forEach(s => s.checked = checked);
        document.querySelectorAll('.select-day').forEach(cb => cb.checked = checked);
        Object.values(colCheckboxes).forEach(cb => { if(cb) cb.checked = checked; });
    });

    document.querySelectorAll('.time-slot').forEach(slot => {
        slot.addEventListener('change', () => {
            syncRowCheckboxes();
            syncColumnCheckboxes();
            syncGlobalCheckbox();
        });
    });

    function syncRowCheckboxes() {
        document.querySelectorAll('.select-day').forEach(cb => {
            const day = cb.dataset.day;
            const slots = document.querySelectorAll(`.time-slot[data-day="${day}"]`);
            cb.checked = Array.from(slots).every(s => s.checked);
        });
    }

    function syncColumnCheckboxes() {
        ['morning','afternoon','evening'].forEach(time => {
            const cb = colCheckboxes[time];
            if (!cb) return;
            cb.checked = Array.from(document.querySelectorAll(`.time-slot[data-time="${time}"]`)).every(s => s.checked);
        });
    }

    function syncGlobalCheckbox() {
        selectAllTimes.checked = Array.from(document.querySelectorAll('.time-slot')).every(s => s.checked);
    }

    document.getElementById('scheduleForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const selectedTimes = Array.from(document.querySelectorAll('.time-slot:checked')).map(cb => cb.value);

        if (selectedTimes.length < 4) {
            alert('Please select at least 4 available times.');
            return;
        }

        const submitBtn = document.getElementById('submitBtn');
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
        submitBtn.disabled = true;

        const formData = new FormData();
        formData.append('Submission_Type', 'Scheduling');
        formData.append('Client_Email', clientData.email || '');
        formData.append('Client_Full_Name', clientData.fullName || '');
        formData.append('Original_Phone', clientData.phone || 'N/A');
        formData.append('Contact_Phone', document.getElementById('phone').value);
        formData.append('Referral_Agent', clientData.referralAgent || 'N/A');
        formData.append('Service_Type', clientData.serviceType || '');
        formData.append('Price', clientData.price || '');
        formData.append('Selected_Times', selectedTimes.join(', '));
        formData.append('Total_Times_Selected', selectedTimes.length);

        if (clientData.screenerResponses) {
            const s = clientData.screenerResponses;
            formData.append('Screener_-_State', s.state === 'qualifying' ? 'Qualifying State (FL, AK, NH, SD, TN, TX, WA, WY)' : 'Other State');
            formData.append('Screener_-_Life_Events', s.lifeEvents ? s.lifeEvents.join(', ') : 'N/A');
            formData.append('Screener_-_Prior_Issues', s.priorIssues ? s.priorIssues.join(', ') : 'N/A');
            formData.append('Screener_-_Tax_Forms', s.taxForms ? s.taxForms.join(', ') : 'N/A');
            formData.append('Screener_-_Income_Sources', s.income ? s.income.join(', ') : 'N/A');
        }

        fetch('https://natoli-tax-handler.qumsieh-luca.workers.dev', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (response.ok) {
                window.location.href = 'thank-you.html';
            } else {
                alert('Oops! There was a problem submitting your availability. Please try again or contact us at natolitaxservice@outlook.com');
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Availability';
                submitBtn.disabled = false;
            }
        })
        .catch(() => {
            alert('Oops! There was a problem submitting your availability. Please try again or contact us at natolitaxservice@outlook.com');
            submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Availability';
            submitBtn.disabled = false;
        });
    });
})();

// ── MOBILE-ONLY DAY NAME SHORTENING ────────────────────────────────
(function () {
    const map = {
        Monday:    "Mon",
        Tuesday:   "Tues",
        Wednesday: "Wed",
        Thursday:  "Thu",
        Friday:    "Fri",
        Saturday:  "Sat"
    };

    function updateDayLabels() {
        const isMobile = window.innerWidth <= 640;
        document.querySelectorAll('.day-name[data-full]').forEach(el => {
            const full = el.dataset.full;
            el.textContent = isMobile ? map[full] : full;
        });
    }

    window.addEventListener('load', updateDayLabels);
    window.addEventListener('resize', updateDayLabels);
})();

// ── Dynamic Header and Footer Loading ───────────────────────────────
function loadComponent(url, containerId) {
    fetch(url)
        .then(response => response.text())
        .then(html => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            doc.querySelectorAll('head link, head style').forEach(elem => {
                const exists = Array.from(document.head.querySelectorAll(elem.tagName)).some(existing => {
                    if (elem.tagName === 'LINK') return existing.href === elem.href;
                    if (elem.tagName === 'STYLE') return existing.textContent === elem.textContent;
                    return false;
                });
                if (!exists) document.head.appendChild(elem.cloneNode(true));
            });
            document.getElementById(containerId).innerHTML = doc.body.innerHTML;
            doc.querySelectorAll('script').forEach(script => {
                const newScript = document.createElement('script');
                if (script.src) newScript.src = script.src;
                else newScript.textContent = script.textContent;
                document.body.appendChild(newScript);
            });
        })
        .catch(error => console.error(`Error loading ${url}:`, error));
}

window.addEventListener('load', () => {
    loadComponent('header.html', 'header-container');
    loadComponent('footer.html', 'footer-container');
});
</script>
</body>
</html>
